<div class="no-data f-16 mt-32 text-center" *ngIf="!apiItems.length">
  <p tr="no-data" class="my-32">暂无数据</p>

  <p tr="project-import-tip-1">1、可点击左侧加号。</p>
  <p tr="project-import-tip-2">2、或左上方地址栏。</p>
  <p tr="project-import-tip-3">3、或拖曳文件到此处。</p>

  <p class="mt-32" tr="project-import-tip">导入 API（仅支持 .json 文件）</p>
</div>

<div *ngIf="apiItems.length" class="api-items flex justify-between mb-16">
  <div>
    <mat-slide-toggle
      class="proxy-setting mr-8"
      color="primary"
      [checked]="showSetting"
      (change)="toggleSetting($event)"
    >
      请求设置
    </mat-slide-toggle>

    <button
      *ngIf="showSetting"
      mat-flat-button
      color="primary"
      class="outlined"
      (click)="save()"
    >
      保存
    </button>
  </div>

  <div *ngIf="apiItems.length">
    <button
      mat-stroked-button
      color="primary"
      class="outlined expand-all mr-10"
      (click)="accordion.openAll()"
      tr="expand-all"
    >
      展开全部
    </button>

    <button
      mat-stroked-button
      color="primary"
      class="outlined close-all"
      (click)="accordion.closeAll()"
      tr="close-all"
    >
      收起全部
    </button>
  </div>
</div>

<div *ngIf="apiItems.length && showSetting" class="auth-setting">
  <mat-slide-toggle
    class="mb-16"
    color="primary"
    [checked]="useProxy"
    (change)="toggleProxy($event)"
  >
    使用代理（全局）
  </mat-slide-toggle>

  <ng-container *ngIf="useProxy">
    <div>以下配置只针对当前 Project：</div>

    <div>
      <mat-form-field class="api-proxy-url">
        <label class="mb-8">API 转发地址</label>

        <input matInput type="url" [(ngModel)]="auth.apiUrl" />
      </mat-form-field>
    </div>

    <mat-radio-group class="flex y-center" [(ngModel)]="auth.kind">
      <label>鉴权方式：</label>

      <mat-radio-button color="primary" value="cookie">
        Cookie
      </mat-radio-button>

      <mat-radio-button class="mx-20" color="primary" value="token">
        Token
      </mat-radio-button>

      <mat-radio-button color="primary" value="other">其它</mat-radio-button>
    </mat-radio-group>

    <div class="mt-10">
      <div *ngIf="auth.kind === 'cookie'">
        <div
          class="cookie-item"
          *ngFor="let cookie of auth.cookie; let i = index"
        >
          <mat-form-field>
            <input matInput placeholder="Key" [(ngModel)]="cookie.key" />
          </mat-form-field>

          <mat-form-field class="mx-10 cookie-input">
            <input matInput placeholder="Value" [(ngModel)]="cookie.value" />
          </mat-form-field>

          <button
            *ngIf="i === 0"
            mat-stroked-button
            color="primary"
            class="outlined mr-8"
            (click)="addCookie()"
          >
            添加
          </button>

          <button
            *ngIf="i !== 0"
            mat-stroked-button
            color="warn"
            class="outlined"
            (click)="removeCookie(i)"
          >
            移除
          </button>
        </div>
      </div>

      <div *ngIf="auth.kind === 'token'">
        <mat-form-field class="full-width">
          <input matInput [(ngModel)]="auth.token" />
        </mat-form-field>
      </div>

      <div *ngIf="auth.kind === 'other'" class="mb-8">其它我就不知道了</div>
    </div>
  </ng-container>
</div>

<mat-accordion multi hideToggle>
  <mat-expansion-panel
    *ngFor="let apiItem of apiItems; let i = index"
    [id]="ID_PREFIX + i"
    [ngClass]="{
      'api-item': true,
      'my-10': true,
      deprecated: apiItem.deprecated
    }"
    [class]="apiItem.__info.method"
    [(expanded)]="expandeds[i]"
  >
    <mat-expansion-panel-header
      class="px-16"
      expandedHeight="48px"
      [class.actived]="i === activedIndex"
      (mousedown)="recordStart()"
      (mouseup)="shouldAvoidSelect(i)"
    >
      <div class="y-center justify-between flex-1">
        <app-api-info class="flex-1" [api]="apiItem.__info"></app-api-info>

        <app-api-request [apiItem]="apiItem"></app-api-request>
      </div>
    </mat-expansion-panel-header>

    <ng-template matExpansionPanelContent>
      <div class="api-detail flex">
        <app-api-parameter
          class="px-10 flex-1"
          [parameters]="apiItem.parameters"
        ></app-api-parameter>

        <app-api-response
          class="px-10 flex-1"
          [responses]="apiItem.responses"
          [produces]="apiItem.produces"
          [produce]="apiItem.__produce"
        ></app-api-response>
      </div>
    </ng-template>
  </mat-expansion-panel>
</mat-accordion>
